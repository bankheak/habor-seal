# Set working directory here
setwd("C:/Users/bankh/My_Repos/habor-seal/data")
# Retrieve data
m.data<-read.csv("m.data.csv")
w.data<-read.csv("w.data.csv")
require(glmmTMB) # for glmm
require(DHARMa) # auto cor and zero-inflation
# Combine location avg noise and total seals within dates
new.w.data<-read.csv("new.w.data.csv")
# Fix date
new.w.data$date<-as.Date(as.character(new.w.data$date),format = "%m/%d/%Y")
m.data$date<-as.Date(as.character(m.data$date),format = "%m/%d/%Y")
new.w.data$j.date<- as.integer(new.w.data$j.date)
new.w.data$j.date<- ifelse(new.w.data$j.date == min(new.w.data$j.date),0, new.w.data$j.date-min(new.w.data$j.date))
m.data$j.date<- as.integer(m.data$j.date)
m.data$j.date<- ifelse(m.data$j.date == min(m.data$j.date),0, m.data$j.date-min(m.data$j.date))
new.w.data$year <-as.numeric(format(new.w.data$date, format = "%Y"))
m.data$year <-as.numeric(format(m.data$date, format = "%Y"))
# Add sample ID
new.w.data$id<- seq_along(new.w.data[,1])
m.data$id<- seq_along(m.data[,1])
# Merge data
full.data<-merge(new.w.data,m.data,all = T)
full.data$site<- as.numeric(full.data$site=="waterfront")
## Organize data by id
full.data<- full.data[order(full.data$id), ]
full.data$obs_id<- seq_along(full.data[,1])
full.data<- full.data[order(full.data$obs_id), ]
# Correct for autocorrelation with ar1()
fittedModel<- glmmTMB(seals ~ noise*site + tide + time + (1 | date) +
ar1(as.factor(j.date) + 0 | month), data = full.data,
family = nbinom2, zi = ~ 1)
res = simulateResiduals(fittedModel)
testTemporalAutocorrelation(res, time = unique(full.data$obs_id))
# Correct for autocorrelation with ar1()
fittedModel<- glmmTMB(seals ~ noise*site + tide + time + (1 | date) +
ar1(as.factor(date) + 0 | month), data = full.data,
family = nbinom2, zi = ~ 1)
res = simulateResiduals(fittedModel)
testTemporalAutocorrelation(res, time = unique(full.data$obs_id))
# Correct for autocorrelation with ar1()
fittedModel<- glmmTMB(seals ~ noise*site + tide + time + (1 | date) +
ar1(as.factor(month) + 0 | year), data = full.data,
family = nbinom2, zi = ~ 1)
res = simulateResiduals(fittedModel)
testTemporalAutocorrelation(res, time = unique(full.data$obs_id))
View(fittedModel)
View(full.data)
# Correct for autocorrelation with ar1()
fittedModel<- glmmTMB(seals ~ noise*site + tide + time + (1 | date) +
ar1(as.factor(month) + 0 | year), data = new.w.data,
family = nbinom2, zi = ~ 1)
# Correct for autocorrelation with ar1()
fittedModel<- glmmTMB(seals ~ noise + tide + time + (1 | date) +
ar1(as.factor(month) + 0 | year), data = new.w.data,
family = nbinom2, zi = ~ 1)
res = simulateResiduals(fittedModel)
testTemporalAutocorrelation(res, time = unique(full.data$id))
# Correct for autocorrelation with ar1()
fittedModel<- glmmTMB(seals ~ noise + tide + time + (1 | date) +
ar1(as.factor(date) + 0 | month), data = new.w.data,
family = nbinom2, zi = ~ 1)
res = simulateResiduals(fittedModel)
testTemporalAutocorrelation(res, time = unique(full.data$id))
# Correct for autocorrelation with ar1()
fittedModel<- glmmTMB(seals ~ noise*site + tide + time + (1 | date) +
ar1(as.factor(j.date) + 0 | month), data = full.data,
family = nbinom2, zi = ~ 1)
res = simulateResiduals(fittedModel)
testTemporalAutocorrelation(res, time = unique(full.data$obs_id))
# Correct for autocorrelation with ar1()
fittedModel<- glmmTMB(seals ~ noise*site + tide + time + (1 | date) +
ar1(as.factor(obs_id) + 0 | month), data = full.data,
family = nbinom2, zi = ~ 1)
res = simulateResiduals(fittedModel)
testTemporalAutocorrelation(res, time = unique(full.data$obs_id))
# Correct for autocorrelation with ar1()
fittedModel<- glmmTMB(seals ~ noise*site + tide + time + (1 | date) +
ar1(as.factor(obs_id) + 0 | date), data = full.data,
family = nbinom2, zi = ~ 1)
# Correct for autocorrelation with ar1()
fittedModel<- glmmTMB(seals ~ noise*site + tide + time + (1 | date) +
ar1(as.factor(month) + 0 | year), data = full.data,
family = nbinom2, zi = ~ 1)
res = simulateResiduals(fittedModel)
testTemporalAutocorrelation(res, time = unique(full.data$obs_id))
### Check Residuals of Month
fit1<- lm(seals~ month + year, data = full.data)
plot(full.data$month, fit1$res, pch=20, col="blue")
abline(h=0) # Add the horizontal line at 0
# Correct for autocorrelation with ar1()
fittedModel<- glmmTMB(seals ~ noise*site + tide + time +
ar1(as.factor(month) + 0 | year), data = full.data,
family = nbinom2, zi = ~ 1)
res = simulateResiduals(fittedModel)
testTemporalAutocorrelation(res, time = unique(full.data$obs_id))
